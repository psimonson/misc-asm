; simple graphics program

[bits 16]
[org 0x100]

%define MEMSIZ 5

[section .data]
message db "Please press a key.",10,13,0
message2 db "Press any key to quit.",0
crlf db 10,13,0
data:
	db "  Small graphics application written in",0x0a,0x0d
	db "16 bit assembler. For DOS, made as a",0x0a,0x0d
	db "COM application. This was designed",0x0a,0x0d
	db "just to show you how to make a very",0x0a,0x0d
	db "simple graphics program.",0x0a,0x0d,0x0a,0x0d,0x20,0x20,0x20
	db 0x20,0x20,0x20,0x57,0x52,0x49,0x54,0x54,0x45,0x4e,0x20,0x42,0x59,0x3a
	db 0x0a,0x0d,0xc9,0xcd,0xcd,0xcd,0xcd,0xcd,0xcd,0xcd,0xcd,0xcd,0xcd,0xcd
	db 0xcd,0xcd,0xcd,0xcd,0xcd,0xcd,0xcd,0xcd,0xcd,0xbb,0x0a,0x0d,0xba,0x20
	db 0x50,0x48,0x49,0x4c,0x49,0x50,0x20,0x52,0x2e,0x20,0x53,0x49,0x4d,0x4f
	db 0x4e,0x53,0x4f,0x4e,0x20,0xba,0x0a,0x0d,0xc8,0xcd,0xcd,0xcd,0xcd,0xcd
	db 0xcd,0xcd,0xcd,0xcd,0xcd,0xcd,0xcd,0xcd,0xcd,0xcd,0xcd,0xcd,0xcd,0xcd
	db 0xcd,0xbc,0x0a,0x0d,0x00
memory: times MEMSIZ+1 db 0

[section .text]
global start
start:
	; setup segment registers
	mov ax, cs
	mov ds, ax
	mov es, ax

	mov eax, 1000
	call timer

	push dx
	mov ax, cx
	mov bx, MEMSIZ
	mov si, memory
	call itoa
	call print

	mov si, crlf
	call print

	pop ax
	mov bx, MEMSIZ
	mov si, memory
	call itoa
	call print

	mov si, crlf
	call print

	mov si, message
	call print

	; wait for a key
	call getc_ignore

	mov ax, 0x0013
	int 0x10

	mov bl, 1
.loop:
	mov ah, 0x02
	mov bh, 0x00
	mov dx, 0x0000
	int 0x10
	push bx
	mov si, data
	call print
	call kbdhit
	cmp al, 0
	jnz .done
	mov eax, 100
	call timer
	pop bx
	inc bl
	cmp bl, 0x0f
	je .change
	jmp .loop

.change:
	mov bl, 1
	push bx
	mov ah, 0x02
	mov bh, 0x00
	mov dx, 0x1800
	int 0x10
	mov bl, 0x03
	mov si, message2
	call print
	mov ah, 0x02
	mov bh, 0x00
	mov dx, 0x0000
	int 0x10
	pop bx
	jmp .loop

.done:
	pop ax

	; change back to text mode (80x25)
	mov ax, 0x0003
	int 0x10

	; terminate COM program
	int 0x20

; =============================== Functions ===============================

%include "funcs.inc"
%include "graph.inc"

